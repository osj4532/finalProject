<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.member">
	<select id="selectByCate" resultType="map" parameterType="int">
		select * from memberview where dept_No = #{deptNo} and ranks_No > 1
	</select>
	
	<select id="selectByNo" resultType="map" parameterType="int">
		select * from memberview where mem_No = #{memberNo}
	</select>
	
	<select id="selectPwdForLogin" parameterType="string" resultType="string">
		select mem_Pwd from member
		where mem_Id=#{memId} and mem_ResignDate is null
	</select>
	
	<select id="selectMember" parameterType="string" resultType="memberVo">
		select * from member where mem_Id=#{memId}
	</select>
	
	<select id="selectOrSearch" resultType="map" parameterType="map">
		select * from memberview
		<if test="keyword != null and keyword != ''">
			where mem_name||dept_name||pos_name like '%'||#{keyword}||'%'
		</if>
	</select>
	
	<select id="countEmail" resultType="int" parameterType="map">
		select count(*) from memberview
		<if test="keyword != null and keyword != ''">
			where mem_name||dept_name||pos_name like '%'||#{keyword}||'%'
		</if>
		order by pos_no, mem_no
	</select>
	
	<select id="selectOrSearchEmail" resultType="map" parameterType="map">
		select B.*
		from
		(
			select rownum RNUM, A.*
			from(
				select * from memberview
				<if test="keyword != null and keyword != ''">
					where mem_name||dept_name||pos_name like '%'||#{keyword}||'%'
				</if>
				order by pos_no, mem_no
			)A
<![CDATA[	where rownum <= #{firstRecordIndex}+#{recordCountPerPage}]]>
		)B
		where B.RNUM > #{firstRecordIndex}
	</select>
	
	<insert id="insertMember" parameterType="MemberVo">
		<selectKey resultType="int" keyProperty="memNo" order="BEFORE">
			select member_seq.nextval from dual
		</selectKey>
		insert into member(mem_no, ranks_no, dept_no, mem_name, mem_hp1, mem_hp2, mem_hp3, mem_email1, mem_email2, mem_id, mem_pwd, mem_zipcode, mem_address, mem_addressdetail, mem_filename, mem_originalfilename, mem_achievement, mem_pay, mem_holiday, pos_no)
		values(#{memNo}, #{ranksNo}, #{deptNo}, #{memName}, #{memHp1}, #{memHp2}, #{memHp3}, #{memEmail1}, #{memEmail2}, #{memId}, #{memPwd}, #{memZipcode}, #{memAddress}, #{memAddressDetail}, #{memFileName}, #{memOriginalFileName}, #{memAchievement}, #{memPay}, #{memHoliday}, #{posNo})
	</insert>
	
	<select id="dupUserid" parameterType="string" resultType="int">
		select count(*) from member where mem_id=#{memId}
	</select>
	
	
	<select id="selectByMemNotoVo" parameterType="int" resultType="memberVo">
		select * from member
		where mem_no = #{memNo}	
	</select>
</mapper>









